<!doctype html>
<html lang="id">
<head>
  <!-- =========================
    BLOK 1 ‚Äî META / SEO / PWA-LITE
  ========================== -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#070612" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Mystery Box Deposit ‚Äî Demo</title>

  <!-- =========================
    BLOK 2 ‚Äî FONTS
  ========================== -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    /* =========================
      BLOK 3 ‚Äî THEME TOKENS (VISION-GLASS)
    ========================== */
    :root{
      --bg0:#070612;
      --bg1:#120a2d;
      --bg2:#1a1143;
      --glass: rgba(255,255,255,.08);
      --glass2: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.14);
      --stroke2: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --faint: rgba(255,255,255,.50);
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --shadow2: 0 10px 28px rgba(0,0,0,.35);
      --radius: 22px;
      --radius2: 16px;
      --pad: 18px;

      --gold:#f7d77a;
      --gold2:#ffd36a;
      --purple:#a56bff;
      --cyan:#5ef6ff;
      --green:#4dffab;
      --red:#ff4d6d;

      --easeOut: cubic-bezier(.16,1,.3,1);
      --easeSmall: cubic-bezier(.2,.8,.2,1);
      --easeSpring: cubic-bezier(.2,1.3,.2,1);
    }

    /* =========================
      BLOK 4 ‚Äî RESET / BASE
    ========================== */
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 15% 10%, rgba(165,107,255,.22), transparent 55%),
        radial-gradient(1000px 700px at 85% 20%, rgba(94,246,255,.14), transparent 55%),
        radial-gradient(900px 700px at 50% 95%, rgba(247,215,122,.10), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 55%, var(--bg0));
      overflow-x:hidden;
    }
    a{ color:inherit; text-decoration:none; }
    button, input, select, textarea{ font:inherit; color:inherit; }
    ::selection{ background: rgba(165,107,255,.28); }

    /* =========================
      BLOK 5 ‚Äî BACKDROP (NOISE + SPARKS)
    ========================== */
    .noise{
      position:fixed; inset:0;
      pointer-events:none; z-index:0;
      opacity:.08;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.5'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
    }
    .sparks{
      position:fixed; inset:-20%;
      pointer-events:none; z-index:0;
      background:
        radial-gradient(3px 3px at 10% 20%, rgba(255,255,255,.55), transparent 60%),
        radial-gradient(2px 2px at 70% 30%, rgba(255,255,255,.35), transparent 60%),
        radial-gradient(2.4px 2.4px at 40% 80%, rgba(255,255,255,.28), transparent 60%),
        radial-gradient(2px 2px at 90% 65%, rgba(255,255,255,.25), transparent 60%),
        radial-gradient(3px 3px at 25% 55%, rgba(255,214,106,.28), transparent 60%),
        radial-gradient(2px 2px at 55% 18%, rgba(165,107,255,.26), transparent 60%),
        radial-gradient(3px 3px at 78% 86%, rgba(94,246,255,.18), transparent 60%);
      filter: blur(.2px);
      animation: drift 14s linear infinite;
      opacity:.7;
    }
    @keyframes drift{
      0%{ transform: translate3d(0,0,0) rotate(0deg); }
      100%{ transform: translate3d(4%, -3%, 0) rotate(6deg); }
    }

    /* =========================
      BLOK 6 ‚Äî LAYOUT / SHELL
    ========================== */
    .wrap{
      position:relative;
      z-index:1;
      max-width:1180px;
      margin:0 auto;
      padding: 26px 18px 40px;
    }

    .topbar{
      display:flex;
      gap:14px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:18px;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      user-select:none;
    }
    .logo{
      width:44px; height:44px; border-radius:14px;
      background:
        radial-gradient(18px 18px at 30% 25%, rgba(255,255,255,.45), transparent 55%),
        radial-gradient(90px 70px at 60% 70%, rgba(247,215,122,.24), transparent 60%),
        linear-gradient(135deg, rgba(165,107,255,.65), rgba(94,246,255,.35));
      box-shadow: 0 18px 60px rgba(165,107,255,.18), 0 14px 32px rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.14);
    }
    .brand h1{
      font-size:16px; margin:0;
      letter-spacing:.2px;
      line-height:1.05;
    }
    .brand p{
      margin:2px 0 0; font-size:12px; color:var(--muted);
    }

    .pill{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow2);
      backdrop-filter: blur(14px) saturate(155%);
      -webkit-backdrop-filter: blur(14px) saturate(155%);
    }
    .pill small{ color:var(--muted); }
    .pill b{ font-weight:800; letter-spacing:.2px; }
    .dot{
      width:10px; height:10px; border-radius:999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.9), rgba(255,255,255,0) 55%), rgba(94,246,255,.55);
      box-shadow: 0 0 0 3px rgba(94,246,255,.12), 0 0 18px rgba(94,246,255,.28);
    }

    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:16px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border:1px solid rgba(255,255,255,.12);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(20px) saturate(170%);
      -webkit-backdrop-filter: blur(20px) saturate(170%);
      overflow:hidden;
    }
    .card .head{
      padding: 16px 18px 12px;
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      background:
        radial-gradient(600px 220px at 20% 0%, rgba(165,107,255,.18), transparent 60%),
        radial-gradient(520px 240px at 90% 10%, rgba(94,246,255,.12), transparent 58%);
    }
    .head h2{
      font-size:14px;
      letter-spacing:.25px;
      margin:0 0 6px;
    }
    .head p{
      margin:0;
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
    }
    .card .body{ padding: 16px 18px 18px; }

    .seg{
      display:flex; gap:8px; flex-wrap:wrap;
      padding: 4px;
      border-radius: 999px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
    }
    .seg button{
      border:0;
      background: transparent;
      padding: 10px 12px;
      border-radius: 999px;
      color: var(--muted);
      cursor:pointer;
      transition: transform .15s var(--easeOut), background .2s var(--easeOut), color .2s var(--easeOut);
    }
    .seg button[aria-selected="true"]{
      background: rgba(255,255,255,.10);
      color: var(--text);
      box-shadow: 0 10px 26px rgba(0,0,0,.25);
    }
    .seg button:active{ transform: scale(.98); }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 560px){
      .row{ grid-template-columns: 1fr; }
    }

    .field{
      display:flex; flex-direction:column; gap:6px;
    }
    .field label{
      font-size:12px;
      color: var(--muted);
    }
    .field input, .field select, .field textarea{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.24);
      outline:none;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
      transition: border-color .2s var(--easeOut), box-shadow .2s var(--easeOut);
    }
    .field input:focus, .field select:focus, .field textarea:focus{
      border-color: rgba(94,246,255,.35);
      box-shadow: 0 0 0 4px rgba(94,246,255,.12);
    }

    .btns{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top: 12px;
    }
    .btn{
      border:0;
      cursor:pointer;
      padding: 12px 14px;
      border-radius: 16px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 14px 32px rgba(0,0,0,.28);
      transition: transform .15s var(--easeOut), filter .2s var(--easeOut), background .2s var(--easeOut);
      display:inline-flex; align-items:center; gap:10px;
      user-select:none;
    }
    .btn:hover{ filter: brightness(1.06); }
    .btn:active{ transform: scale(.985); }
    .btn.primary{
      background:
        radial-gradient(14px 14px at 30% 25%, rgba(255,255,255,.40), transparent 55%),
        linear-gradient(135deg, rgba(165,107,255,.75), rgba(94,246,255,.38));
      border-color: rgba(255,255,255,.18);
    }
    .btn.danger{
      background: rgba(255,77,109,.14);
      border-color: rgba(255,77,109,.22);
    }
    .btn.good{
      background: rgba(77,255,171,.12);
      border-color: rgba(77,255,171,.22);
    }
    .btn.ghost{
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.12);
      box-shadow:none;
    }
    .btn small{ color: rgba(255,255,255,.78); }
    .btn .k{
      width:22px; height:22px; border-radius:8px;
      background: rgba(0,0,0,.26);
      border: 1px solid rgba(255,255,255,.12);
      display:grid; place-items:center;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.05);
    }

    .note{
      padding: 12px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: var(--muted);
      font-size:12px;
      line-height:1.5;
    }
    .note b{ color: var(--text); }

    .list{
      display:flex; flex-direction:column; gap:10px;
      margin-top:12px;
    }
    .item{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      border-radius: 18px;
      padding: 12px 12px;
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .item .left{ min-width:0; }
    .item .title{
      margin:0; font-size:13px; font-weight:800;
      letter-spacing:.2px;
    }
    .item .meta{
      margin:4px 0 0;
      font-size:12px; color: var(--muted);
      line-height:1.35;
      word-break:break-word;
    }
    .item .right{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .tag{
      font-size:11px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.86);
    }
    .tag.warn{
      border-color: rgba(247,215,122,.22);
      background: rgba(247,215,122,.10);
    }
    .tag.good{
      border-color: rgba(77,255,171,.24);
      background: rgba(77,255,171,.10);
    }
    .tag.bad{
      border-color: rgba(255,77,109,.26);
      background: rgba(255,77,109,.12);
    }

    /* =========================
      BLOK 7 ‚Äî HERO / BOX ILLUSTRATION
    ========================== */
    .hero{
      position:relative;
      padding: 18px 18px 14px;
      border-radius: var(--radius);
      border:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(740px 240px at 15% 0%, rgba(165,107,255,.18), transparent 55%),
        radial-gradient(640px 260px at 90% 20%, rgba(94,246,255,.14), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow2);
      overflow:hidden;
      margin-bottom: 16px;
    }
    .heroGrid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 14px;
      align-items:center;
    }
    @media (max-width: 820px){
      .heroGrid{ grid-template-columns: 1fr; }
    }
    .hero h3{
      margin:0 0 8px;
      font-size:18px;
      letter-spacing:.2px;
    }
    .hero .sub{
      margin:0;
      font-size:12.5px;
      color: var(--muted);
      line-height: 1.45;
    }

    .boxArt{
      position:relative;
      height: 150px;
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(160px 120px at 30% 25%, rgba(255,255,255,.18), transparent 60%),
        radial-gradient(220px 180px at 70% 70%, rgba(247,215,122,.16), transparent 65%),
        linear-gradient(135deg, rgba(165,107,255,.32), rgba(94,246,255,.16));
      box-shadow: 0 24px 70px rgba(0,0,0,.45);
      overflow:hidden;
    }
    .boxArt::before{
      content:"";
      position:absolute; inset:-40%;
      background:
        conic-gradient(from 210deg, rgba(255,255,255,.0), rgba(255,255,255,.14), rgba(255,255,255,0) 55%),
        radial-gradient(closest-side, rgba(255,255,255,.12), transparent 68%);
      filter: blur(1px);
      animation: sheen 5.8s linear infinite;
      opacity:.65;
    }
    .boxCube{
      position:absolute;
      left:50%; top:54%;
      width: 96px; height: 76px;
      transform: translate(-50%,-50%) rotateX(12deg);
      border-radius: 18px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.20), rgba(255,255,255,.06)),
        radial-gradient(70px 60px at 30% 20%, rgba(255,255,255,.28), transparent 55%),
        linear-gradient(135deg, rgba(247,215,122,.55), rgba(165,107,255,.28));
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 20px 60px rgba(0,0,0,.45);
    }
    .boxLid{
      position:absolute;
      left:50%; top:36%;
      width: 104px; height: 26px;
      transform: translate(-50%,-50%);
      border-radius: 16px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,.08)),
        linear-gradient(135deg, rgba(94,246,255,.26), rgba(165,107,255,.22));
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 14px 32px rgba(0,0,0,.35);
      animation: bob 2.8s var(--easeSmall) infinite;
      transform-origin: 50% 100%;
    }
    .boxBand{
      position:absolute; left:50%; top:54%;
      width: 110px; height: 10px;
      transform: translate(-50%,-50%);
      border-radius: 999px;
      background: rgba(0,0,0,.20);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.05);
    }
    .glowOrb{
      position:absolute;
      right: -16px; bottom: -16px;
      width: 120px; height: 120px;
      border-radius:999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), rgba(255,255,255,0) 55%), rgba(94,246,255,.20);
      filter: blur(.2px);
      box-shadow: 0 0 0 18px rgba(94,246,255,.08), 0 0 80px rgba(94,246,255,.22);
      opacity:.75;
    }
    @keyframes sheen{
      0%{ transform: translate3d(-4%,-2%,0) rotate(0deg); }
      100%{ transform: translate3d(4%,2%,0) rotate(360deg); }
    }
    @keyframes bob{
      0%,100%{ transform: translate(-50%,-50%) rotate(0deg); }
      50%{ transform: translate(-50%,-56%) rotate(-3deg); }
    }

    /* =========================
      BLOK 8 ‚Äî TABLE (ODDS)
    ========================== */
    .tableWrap{
      border-radius: 18px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
    }
    table{
      width:100%;
      border-collapse: collapse;
      font-size:12px;
    }
    thead th{
      text-align:left;
      padding: 12px 12px;
      color: rgba(255,255,255,.82);
      background: rgba(255,255,255,.06);
      border-bottom: 1px solid rgba(255,255,255,.08);
      font-weight:800;
      letter-spacing:.2px;
    }
    tbody td{
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      color: rgba(255,255,255,.88);
      vertical-align: top;
    }
    tbody tr:last-child td{ border-bottom:0; }
    .pct{
      text-align:right;
      font-variant-numeric: tabular-nums;
      color: rgba(255,255,255,.86);
      white-space:nowrap;
    }

    /* =========================
      BLOK 9 ‚Äî TOAST / MODAL
    ========================== */
    .toast{
      position: fixed;
      left:50%;
      bottom: 18px;
      transform: translateX(-50%);
      z-index: 999;
      padding: 12px 14px;
      border-radius: 999px;
      background: rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(16px) saturate(160%);
      -webkit-backdrop-filter: blur(16px) saturate(160%);
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
      display:none;
      gap:10px;
      align-items:center;
      max-width: calc(100vw - 24px);
      color: rgba(255,255,255,.90);
      font-size:12.5px;
    }
    .toast.show{ display:flex; animation: pop .32s var(--easeSpring); }
    @keyframes pop{
      0%{ transform: translateX(-50%) translateY(8px) scale(.98); opacity:0; }
      100%{ transform: translateX(-50%) translateY(0) scale(1); opacity:1; }
    }
    .toast .tDot{
      width:10px; height:10px; border-radius:999px;
      background: rgba(255,255,255,.18);
      box-shadow: 0 0 0 3px rgba(255,255,255,.06);
    }
    .toast.good .tDot{ background: rgba(77,255,171,.60); box-shadow:0 0 0 3px rgba(77,255,171,.14), 0 0 18px rgba(77,255,171,.22); }
    .toast.bad  .tDot{ background: rgba(255,77,109,.60); box-shadow:0 0 0 3px rgba(255,77,109,.14), 0 0 18px rgba(255,77,109,.20); }
    .toast.warn .tDot{ background: rgba(247,215,122,.70); box-shadow:0 0 0 3px rgba(247,215,122,.14), 0 0 18px rgba(247,215,122,.20); }

    /* =========================
      BLOK 10 ‚Äî SMALL UTILITIES
    ========================== */
    .muted{ color: var(--muted); }
    .faint{ color: var(--faint); }
    .hr{
      height:1px;
      background: rgba(255,255,255,.08);
      margin: 14px 0;
    }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    .mini{
      font-size:11.5px;
      color: var(--muted);
      line-height:1.45;
    }
    .rightActions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      align-items:center;
    }
  </style>
</head>

<body>
  <div class="sparks"></div>
  <div class="noise"></div>

  <div class="wrap">
    <!-- =========================
      BLOK 11 ‚Äî TOPBAR
    ========================== -->
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Mystery Box Deposit</h1>
          <p>Deposit ‚â• <b>Rp20.000</b> ‚Üí Ajukan Claim ‚Üí Kode Voucher ‚Üí Box Aktif ‚Üí Buka Box</p>
        </div>
      </div>

      <div class="pill" title="Demo lokal (LocalStorage)">
        <span class="dot" aria-hidden="true"></span>
        <div>
          <small>Status</small><br>
          <b id="pillStatus">Demo aktif</b>
        </div>
      </div>
    </div>

    <!-- =========================
      BLOK 12 ‚Äî HERO
    ========================== -->
    <div class="hero">
      <div class="heroGrid">
        <div>
          <h3>Konsep realistis: CS hanya verifikasi, sistem yang menentukan hadiah</h3>
          <p class="sub">
            Kode voucher <b>sekali pakai</b> dan <b>terikat username + transaksi</b>. Expired <b>15‚Äì30 menit</b>.
            Maksimal <b>3x</b> percobaan input kode. Hadiah ‚ÄúSpin manual‚Äù punya masa aktif <b>24 jam</b>.
          </p>

          <div class="hr"></div>

          <div class="note">
            <b>Catatan jujur untuk produksi:</b> versi ini adalah <u>demo front-end</u>. Untuk benar-benar aman & tidak bisa dimanipulasi,
            generate kode + RNG hadiah + pencatatan spin harus dilakukan <b>server-side</b>, dan integrasi provider (Pragmatic/PGSoft)
            butuh sistem bonus engine/aggregator.
          </div>
        </div>

        <div class="boxArt" aria-hidden="true">
          <div class="boxLid"></div>
          <div class="boxCube"></div>
          <div class="boxBand"></div>
          <div class="glowOrb"></div>
        </div>
      </div>
    </div>

    <!-- =========================
      BLOK 13 ‚Äî MAIN GRID
    ========================== -->
    <div class="grid">
      <!-- =========================
        BLOK 13A ‚Äî MEMBER / CS PANEL (LEFT)
      ========================== -->
      <div class="card">
        <div class="head">
          <div>
            <h2>Panel Event</h2>
            <p>Simulasi lengkap: ajukan claim ‚Üí CS approve ‚Üí kode ‚Üí box aktif ‚Üí hadiah.</p>
          </div>
          <div class="seg" role="tablist" aria-label="Mode panel">
            <button id="tabMember" role="tab" aria-selected="true">Member</button>
            <button id="tabCS" role="tab" aria-selected="false">CS</button>
          </div>
        </div>

        <div class="body">
          <!-- =========================
            BLOK 13A.1 ‚Äî MEMBER VIEW
          ========================== -->
          <section id="viewMember">
            <div class="row">
              <div class="field">
                <label>Username</label>
                <input id="m_username" placeholder="contoh: garr123" autocomplete="off" />
              </div>
              <div class="field">
                <label>Nominal Deposit (Rp)</label>
                <input id="m_nominal" placeholder="20000" inputmode="numeric" autocomplete="off" />
              </div>
            </div>

            <div class="row" style="margin-top:12px;">
              <div class="field">
                <label>Referensi Transaksi / TRX ID</label>
                <input id="m_trx" placeholder="contoh: TRX-20251206-001" autocomplete="off" />
              </div>
              <div class="field">
                <label>Bukti deposit (opsional, link/teks)</label>
                <input id="m_proof" placeholder="opsional" autocomplete="off" />
              </div>
            </div>

            <div class="btns">
              <button class="btn primary" id="btnSubmitClaim">
                <span class="k">‚úì</span> Ajukan Claim
              </button>
              <button class="btn ghost" id="btnFillDemo">
                <span class="k">‚òÖ</span> Isi Contoh
              </button>
            </div>

            <div class="hr"></div>

            <h2 style="font-size:14px; margin:0 0 8px;">Aktivasi Box (Input Kode Voucher)</h2>
            <p class="mini" style="margin-top:0;">
              Masukkan <b>username</b>, <b>TRX</b>, dan <b>kode</b> yang diberikan CS. Kode berlaku 15‚Äì30 menit, dan maksimal 3x percobaan.
            </p>

            <div class="row">
              <div class="field">
                <label>Username</label>
                <input id="a_username" placeholder="harus sama seperti claim" autocomplete="off" />
              </div>
              <div class="field">
                <label>TRX ID</label>
                <input id="a_trx" placeholder="harus sama seperti claim" autocomplete="off" />
              </div>
            </div>

            <div class="row" style="margin-top:12px;">
              <div class="field" style="grid-column: 1 / -1;">
                <label>Kode Voucher</label>
                <input id="a_code" class="mono" placeholder="contoh: 8KQ7J2MZ" autocomplete="off" />
              </div>
            </div>

            <div class="btns">
              <button class="btn good" id="btnActivate">
                <span class="k">‚ö°</span> Aktivasi Box
              </button>
            </div>

            <div class="hr"></div>

            <h2 style="font-size:14px; margin:0 0 8px;">Kotak Saya</h2>
            <div id="myBoxes" class="list"></div>

            <div class="hr"></div>

            <h2 style="font-size:14px; margin:0 0 8px;">Hadiah Saya</h2>
            <div id="myRewards" class="list"></div>
          </section>

          <!-- =========================
            BLOK 13A.2 ‚Äî CS VIEW
          ========================== -->
          <section id="viewCS" style="display:none;">
            <div class="note">
              <b>Aturan tegas (sesuai kebutuhan kamu):</b><br>
              ‚Ä¢ Kode <b>sekali pakai</b>, terikat <b>username + transaksi</b><br>
              ‚Ä¢ Expired cepat <b>15‚Äì30 menit</b><br>
              ‚Ä¢ Limit percobaan input kode <b>3x</b><br>
              <span class="faint">Di demo ini, CS hanya memverifikasi deposit & generate kode. Hadiah tetap ditentukan saat box dibuka.</span>
            </div>

            <div class="hr"></div>

            <div class="row">
              <div class="field">
                <label>Expired kode (menit)</label>
                <select id="cs_expiry">
                  <option value="15">15 menit</option>
                  <option value="20" selected>20 menit</option>
                  <option value="30">30 menit</option>
                </select>
              </div>
              <div class="field">
                <label>Panjang kode</label>
                <select id="cs_len">
                  <option value="6">6 karakter</option>
                  <option value="8" selected>8 karakter</option>
                  <option value="10">10 karakter</option>
                </select>
              </div>
            </div>

            <div class="btns">
              <button class="btn ghost" id="btnSeedDemo">
                <span class="k">‚ûï</span> Buat 2 Claim Dummy
              </button>
              <button class="btn danger" id="btnResetAll">
                <span class="k">‚Ü∫</span> Reset Demo Data
              </button>
            </div>

            <div class="hr"></div>

            <h2 style="font-size:14px; margin:0 0 8px;">Claim Masuk (Pending)</h2>
            <div id="csPending" class="list"></div>

            <div class="hr"></div>

            <h2 style="font-size:14px; margin:0 0 8px;">Kode Aktif (Belum dipakai)</h2>
            <div id="csCodes" class="list"></div>

            <div class="hr"></div>

            <h2 style="font-size:14px; margin:0 0 8px;">Audit Log</h2>
            <div id="csAudit" class="list"></div>
          </section>
        </div>
      </div>

      <!-- =========================
        BLOK 13B ‚Äî ODDS + RULES (RIGHT)
      ========================== -->
      <div class="card">
        <div class="head">
          <div>
            <h2>Peluang Hadiah (Transparan)</h2>
            <p>Total 100%. Kamu bisa ganti angka odds ini kapan pun (untuk produksi: server-side).</p>
          </div>
          <div class="rightActions">
            <span class="tag warn" title="Masa aktif hadiah spin">Spin aktif 24 jam</span>
            <span class="tag" title="Provider yang berlaku">PRAGMATIC ‚Ä¢ PGSOFT</span>
          </div>
        </div>

        <div class="body">
          <div class="tableWrap" aria-label="Tabel peluang hadiah">
            <table>
              <thead>
                <tr>
                  <th>Hadiah</th>
                  <th style="width:110px; text-align:right;">Peluang</th>
                </tr>
              </thead>
              <tbody id="oddsTbody"></tbody>
            </table>
          </div>

          <div class="hr"></div>

          <div class="note">
            <b>Spin manual (paket final):</b><br>
            ‚Ä¢ 10x ‚Äî nilai/spin Rp400<br>
            ‚Ä¢ 50x ‚Äî nilai/spin Rp1.000<br>
            ‚Ä¢ 100x ‚Äî nilai/spin Rp2.000<br>
            <span class="faint">Masa aktif 24 jam. Untuk produksi, ‚Äúotomatis masuk provider‚Äù butuh integrasi bonus engine/aggregator.</span>
          </div>

          <div class="hr"></div>

          <div class="note">
            <b>Best practice anti-komplain:</b><br>
            ‚Ä¢ Tampilkan riwayat hadiah per user<br>
            ‚Ä¢ Jelaskan definisi ‚Äúspin‚Äù + provider berlaku<br>
            ‚Ä¢ Hindari ‚Äúkonfirmasi dua kali‚Äù; cukup aktivasi ‚Üí box aktif ‚Üí buka box
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- =========================
    BLOK 14 ‚Äî TOAST
  ========================== -->
  <div class="toast" id="toast" role="status" aria-live="polite">
    <span class="tDot" aria-hidden="true"></span>
    <span id="toastText">‚Äî</span>
  </div>

  <script>
    /* =========================
      BLOK 15 ‚Äî DATA MODEL (DEMO STORAGE)
    ========================== */
    const STORE_KEY = "mystery_box_deposit_demo_v1";

    const ODDS = [
      // Cashback (contoh realistis + total tetap 100%)
      { id:"cb5",   label:"Cashback 5% (maks Rp1.000)",  type:"cashback", pct:49.5, data:{percent:5, cap:1000} },
      { id:"cb8",   label:"Cashback 8% (maks Rp2.000)",  type:"cashback", pct:18.0, data:{percent:8, cap:2000} },
      { id:"cb12",  label:"Cashback 12% (maks Rp3.000)", type:"cashback", pct:10.0, data:{percent:12, cap:3000} },
      { id:"cb20",  label:"Cashback 20% (maks Rp5.000)", type:"cashback", pct:5.0,  data:{percent:20, cap:5000} },
      { id:"cb50",  label:"Cashback 50% (maks Rp10.000)",type:"cashback", pct:0.5,  data:{percent:50, cap:10000} },

      // Spin manual (paket final kamu)
      { id:"sp10",  label:"Spin 10x (Rp400/spin) ‚Äî Pragmatic/PGSoft",  type:"spin", pct:12.0, data:{spins:10, bet:400} },
      { id:"sp50",  label:"Spin 50x (Rp1.000/spin) ‚Äî Pragmatic/PGSoft",type:"spin", pct:3.8,  data:{spins:50, bet:1000} },
      { id:"sp100", label:"Spin 100x (Rp2.000/spin) ‚Äî Pragmatic/PGSoft",type:"spin", pct:0.7,  data:{spins:100, bet:2000} },

      // Voucher (contoh: transparan)
      { id:"v50k",  label:"Voucher Rp50.000", type:"voucher", pct:0.45, data:{amount:50000} },
      { id:"v1jt",  label:"Voucher Rp1.000.000", type:"voucher", pct:0.05, data:{amount:1000000} },
    ];

    function now(){ return Date.now(); }
    function fmtMoney(n){
      const x = Math.max(0, Math.floor(Number(n)||0));
      return "Rp" + x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }
    function fmtTime(ts){
      const d = new Date(ts);
      const pad = (v)=> String(v).padStart(2,"0");
      return `${pad(d.getDate())}-${pad(d.getMonth()+1)}-${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    }
    function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); }
    function safeJSONParse(s, fallback){
      try{ return JSON.parse(s); }catch(e){ return fallback; }
    }
    function uid(prefix="id"){
      return prefix + "_" + Math.random().toString(16).slice(2) + "_" + Date.now().toString(16);
    }

    const state = loadState();

    function loadState(){
      const base = { claims:[], codes:[], boxes:[], rewards:[], audit:[] };
      const raw = localStorage.getItem(STORE_KEY);
      if(!raw) return base;
      const parsed = safeJSONParse(raw, base);
      // harden structure
      return {
        claims: Array.isArray(parsed.claims)? parsed.claims : [],
        codes:  Array.isArray(parsed.codes)? parsed.codes : [],
        boxes:  Array.isArray(parsed.boxes)? parsed.boxes : [],
        rewards:Array.isArray(parsed.rewards)? parsed.rewards : [],
        audit:  Array.isArray(parsed.audit)? parsed.audit : [],
      };
    }
    function save(){
      localStorage.setItem(STORE_KEY, JSON.stringify(state));
      renderAll();
    }

    /* =========================
      BLOK 16 ‚Äî CRYPTO (HASH CODE)
    ========================== */
    async function sha256Hex(text){
      // Prefer WebCrypto (HTTPS). Fallback is NOT secure‚Äîdemo only.
      if (window.crypto && crypto.subtle && window.TextEncoder) {
        const enc = new TextEncoder().encode(text);
        const buf = await crypto.subtle.digest("SHA-256", enc);
        const arr = Array.from(new Uint8Array(buf));
        return arr.map(b=>b.toString(16).padStart(2,"0")).join("");
      }
      // Fallback: simple hash (not secure)
      let h=2166136261;
      for(let i=0;i<text.length;i++){
        h ^= text.charCodeAt(i);
        h = Math.imul(h, 16777619);
      }
      return ("00000000"+(h>>>0).toString(16)).slice(-8) + "_demo";
    }

    function randCode(len=8){
      const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789"; // no 0/1/I/O for clarity
      let out = "";
      const arr = new Uint32Array(len);
      if (window.crypto && crypto.getRandomValues) crypto.getRandomValues(arr);
      for(let i=0;i<len;i++){
        const r = arr[i] ? arr[i] : Math.floor(Math.random()*1e9);
        out += chars[r % chars.length];
      }
      return out;
    }

    /* =========================
      BLOK 17 ‚Äî TOAST
    ========================== */
    let toastTimer = null;
    function toast(msg, kind=""){
      const el = document.getElementById("toast");
      const tx = document.getElementById("toastText");
      tx.textContent = msg;
      el.className = "toast show" + (kind ? " " + kind : "");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> el.className="toast", 2300);
    }

    /* =========================
      BLOK 18 ‚Äî BUSINESS LOGIC
    ========================== */
    function addAudit(text){
      state.audit.unshift({ id: uid("au"), ts: now(), text });
      state.audit = state.audit.slice(0, 60);
    }

    function findClaim(username, trx){
      return state.claims.find(c => c.username === username && c.trx_ref === trx);
    }
    function hasBox(username, trx){
      return state.boxes.some(b => b.username === username && b.trx_ref === trx);
    }

    function validateNominal(n){
      const v = Math.floor(Number(n)||0);
      if (!Number.isFinite(v)) return { ok:false, v:0 };
      if (v < 20000) return { ok:false, v };
      return { ok:true, v };
    }

    function weightedPick(){
      const total = ODDS.reduce((s,x)=>s + x.pct, 0);
      const r = Math.random()*total;
      let acc=0;
      for(const item of ODDS){
        acc += item.pct;
        if(r <= acc) return item;
      }
      return ODDS[ODDS.length-1];
    }

    function rewardLabel(r){
      if(r.type === "cashback"){
        return `Cashback ${r.data.percent}% (maks ${fmtMoney(r.data.cap)})`;
      }
      if(r.type === "spin"){
        return `Spin ${r.data.spins}x ‚Äî ${fmtMoney(r.data.bet)}/spin`;
      }
      if(r.type === "voucher"){
        return `Voucher ${fmtMoney(r.data.amount)}`;
      }
      return "Hadiah";
    }

    function msLeft(ts){
      return Math.max(0, ts - now());
    }
    function fmtLeft(ms){
      const s = Math.floor(ms/1000);
      const m = Math.floor(s/60);
      const r = s%60;
      return `${m}m ${String(r).padStart(2,"0")}s`;
    }
    function fmtLeftHours(ms){
      const s = Math.floor(ms/1000);
      const h = Math.floor(s/3600);
      const m = Math.floor((s%3600)/60);
      return `${h}j ${String(m).padStart(2,"0")}m`;
    }

    /* =========================
      BLOK 19 ‚Äî UI HANDLERS
    ========================== */
    const $ = (id)=> document.getElementById(id);

    function setTab(which){
      const isMember = which === "member";
      $("tabMember").setAttribute("aria-selected", isMember ? "true":"false");
      $("tabCS").setAttribute("aria-selected", isMember ? "false":"true");
      $("viewMember").style.display = isMember ? "" : "none";
      $("viewCS").style.display = isMember ? "none" : "";
    }

    $("tabMember").addEventListener("click", ()=> setTab("member"));
    $("tabCS").addEventListener("click", ()=> setTab("cs"));

    $("btnFillDemo").addEventListener("click", ()=>{
      const uname = "garr" + Math.floor(100 + Math.random()*900);
      $("m_username").value = uname;
      $("m_nominal").value = "20000";
      $("m_trx").value = "TRX-" + new Date().toISOString().slice(0,10).replaceAll("-","") + "-" + Math.floor(10 + Math.random()*90);
      $("m_proof").value = "bukti opsional";
      $("a_username").value = uname;
      $("a_trx").value = $("m_trx").value;
      toast("Contoh form diisi.", "good");
    });

    $("btnSubmitClaim").addEventListener("click", ()=>{
      const username = ($("m_username").value||"").trim();
      const trx_ref = ($("m_trx").value||"").trim();
      const proof = ($("m_proof").value||"").trim();
      const nominalRaw = ($("m_nominal").value||"").trim().replace(/[^\d]/g,"");
      const { ok, v:nominal } = validateNominal(nominalRaw);

      if(!username || !trx_ref){
        toast("Username dan TRX wajib diisi.", "bad");
        return;
      }
      if(!ok){
        toast("Nominal minimal Rp20.000.", "warn");
        return;
      }
      if(findClaim(username, trx_ref)){
        toast("Claim untuk TRX ini sudah pernah dibuat.", "warn");
        return;
      }
      if(hasBox(username, trx_ref)){
        toast("Box untuk TRX ini sudah aktif/terbuat.", "warn");
        return;
      }

      state.claims.unshift({
        id: uid("cl"),
        username,
        trx_ref,
        nominal,
        proof,
        status: "pending",
        created_at: now(),
        reviewed_at: null,
      });
      addAudit(`Claim masuk: ${username} ‚Ä¢ ${trx_ref} ‚Ä¢ ${fmtMoney(nominal)}`);
      toast("Claim dikirim. Menunggu verifikasi CS.", "good");
      // convenience
      $("a_username").value = username;
      $("a_trx").value = trx_ref;
      save();
    });

    $("btnSeedDemo").addEventListener("click", ()=>{
      const mk = (u, t, n)=>({
        id: uid("cl"),
        username:u, trx_ref:t, nominal:n, proof:"", status:"pending", created_at:now(), reviewed_at:null
      });
      const d1 = "demo" + Math.floor(100+Math.random()*900);
      const d2 = "demo" + Math.floor(100+Math.random()*900);
      state.claims.unshift(mk(d1, "TRX-DEMO-" + Math.floor(1000+Math.random()*9000), 20000));
      state.claims.unshift(mk(d2, "TRX-DEMO-" + Math.floor(1000+Math.random()*9000), 50000));
      addAudit("CS membuat 2 claim dummy.");
      toast("2 claim dummy dibuat.", "good");
      save();
    });

    $("btnResetAll").addEventListener("click", ()=>{
      localStorage.removeItem(STORE_KEY);
      location.reload();
    });

    async function csApprove(claimId){
      const claim = state.claims.find(c=>c.id===claimId);
      if(!claim) return;
      // approve only if still pending
      if(claim.status !== "pending"){
        toast("Claim ini sudah diproses.", "warn");
        return;
      }
      const expMin = Number($("cs_expiry").value||20);
      const len = Number($("cs_len").value||8);

      // create code (plaintext only to show CS for demo; store hash in db)
      const codePlain = randCode(len);
      const codeHash = await sha256Hex(codePlain);

      // One-time code tied to username + trx_ref
      const expires_at = now() + clamp(expMin, 15, 30) * 60 * 1000;

      state.codes.unshift({
        id: uid("cd"),
        username: claim.username,
        trx_ref: claim.trx_ref,
        code_hash: codeHash,
        // demo-only display:
        code_preview: codePlain,
        expires_at,
        attempts_left: 3,
        used_at: null,
        created_at: now(),
      });

      claim.status = "approved";
      claim.reviewed_at = now();

      // Create locked box (will be activated after code used)
      if(!hasBox(claim.username, claim.trx_ref)){
        state.boxes.unshift({
          id: uid("bx"),
          username: claim.username,
          trx_ref: claim.trx_ref,
          nominal: claim.nominal,
          status: "locked", // becomes active when code used
          created_at: now(),
          activated_at: null,
          opened_at: null
        });
      }

      addAudit(`CS approve + generate kode: ${claim.username} ‚Ä¢ ${claim.trx_ref} (exp ${expMin}m)`);
      toast("Kode dibuat. Kirim ke member.", "good");
      save();
    }

    function csReject(claimId){
      const claim = state.claims.find(c=>c.id===claimId);
      if(!claim) return;
      if(claim.status !== "pending"){
        toast("Claim ini sudah diproses.", "warn");
        return;
      }
      claim.status = "rejected";
      claim.reviewed_at = now();
      addAudit(`CS reject: ${claim.username} ‚Ä¢ ${claim.trx_ref}`);
      toast("Claim ditolak.", "warn");
      save();
    }

    async function activateBox(){
      const username = ($("a_username").value||"").trim();
      const trx_ref  = ($("a_trx").value||"").trim();
      const code     = ($("a_code").value||"").trim().toUpperCase();

      if(!username || !trx_ref || !code){
        toast("Username, TRX, dan kode wajib diisi.", "bad");
        return;
      }

      // find latest valid code tied to username+trx
      const allCodes = state.codes.filter(cd => cd.username===username && cd.trx_ref===trx_ref);
      if(allCodes.length === 0){
        toast("Tidak ada kode untuk username+TRX ini.", "bad");
        return;
      }

      // Prefer unused & not expired
      const activeCode = allCodes.find(cd => !cd.used_at && cd.expires_at > now());
      if(!activeCode){
        toast("Kode sudah expired / juga tidak ada yang aktif. Minta CS buat kode baru.", "warn");
        return;
      }

      if(activeCode.attempts_left <= 0){
        toast("Limit 3x salah tercapai. Minta CS buat kode baru.", "bad");
        return;
      }

      const hash = await sha256Hex(code);
      if(hash !== activeCode.code_hash){
        activeCode.attempts_left = Math.max(0, activeCode.attempts_left - 1);
        addAudit(`Gagal input kode: ${username} ‚Ä¢ ${trx_ref} (sisa ${activeCode.attempts_left}x)`);
        save();
        toast(`Kode salah. Sisa percobaan: ${activeCode.attempts_left}x`, activeCode.attempts_left ? "warn":"bad");
        return;
      }

      // valid
      activeCode.used_at = now();
      addAudit(`Kode dipakai: ${username} ‚Ä¢ ${trx_ref}`);

      // activate box
      const box = state.boxes.find(b=>b.username===username && b.trx_ref===trx_ref);
      if(!box){
        // should exist if CS followed flow, but keep safe
        state.boxes.unshift({
          id: uid("bx"),
          username, trx_ref, nominal: 20000,
          status:"active", created_at:now(), activated_at:now(), opened_at:null
        });
      }else{
        box.status = "active";
        box.activated_at = now();
      }

      toast("Box aktif ‚úÖ Silakan buka box kamu.", "good");
      $("a_code").value = "";
      save();
    }

    $("btnActivate").addEventListener("click", activateBox);

    function openBox(boxId){
      const box = state.boxes.find(b=>b.id===boxId);
      if(!box) return;

      if(box.status !== "active"){
        toast("Box belum aktif. Aktivasi pakai kode dulu.", "warn");
        return;
      }
      if(box.opened_at){
        toast("Box ini sudah dibuka.", "warn");
        return;
      }

      // pick reward by odds
      const pick = weightedPick();

      const reward = {
        id: uid("rw"),
        username: box.username,
        trx_ref: box.trx_ref,
        created_at: now(),
        type: pick.type,
        title: pick.label,
        // reward validity: 24h for spin and voucher (cashback can be immediate, but we keep expiry too for transparency)
        expires_at: now() + 24*60*60*1000,
        status: "granted",
        payload: {
          ...pick.data,
          provider: null,
          // for spin tracking (demo)
          spins_done: 0
        }
      };

      // compute cashback nominal for demo
      if(reward.type === "cashback"){
        const amountRaw = Math.floor((box.nominal * (reward.payload.percent/100)));
        reward.payload.amount = Math.min(amountRaw, reward.payload.cap);
      }

      // mark box opened
      box.opened_at = now();
      box.status = "opened";

      state.rewards.unshift(reward);
      addAudit(`Box dibuka: ${box.username} ‚Ä¢ ${box.trx_ref} ‚Üí ${rewardLabel(reward)}`);
      toast("üéÅ Selamat! Hadiah keluar.", "good");
      save();
    }

    function setProvider(rewardId, provider){
      const r = state.rewards.find(x=>x.id===rewardId);
      if(!r || r.type !== "spin") return;
      if(r.expires_at <= now()){
        toast("Reward sudah expired (24 jam).", "bad");
        return;
      }
      r.payload.provider = provider;
      addAudit(`Provider dipilih: ${r.username} ‚Ä¢ ${r.trx_ref} ‚Üí ${provider}`);
      toast(`Provider dipilih: ${provider}`, "good");
      save();
    }

    // Demo-only: simulate spins progress (no money calc)
    function simulateSpin(rewardId){
      const r = state.rewards.find(x=>x.id===rewardId);
      if(!r || r.type !== "spin") return;
      if(r.expires_at <= now()){
        toast("Reward sudah expired (24 jam).", "bad");
        return;
      }
      if(!r.payload.provider){
        toast("Pilih provider dulu (Pragmatic / PGSoft).", "warn");
        return;
      }

      const total = r.payload.spins;
      const step = Math.min(5, total - r.payload.spins_done);
      r.payload.spins_done += step;

      if(r.payload.spins_done >= total){
        r.payload.spins_done = total;
        r.status = "completed";
        addAudit(`Spin selesai: ${r.username} ‚Ä¢ ${r.trx_ref} (${total}x)`);
        toast("Spin selesai ‚úÖ (demo)", "good");
      }else{
        toast(`Progress spin: ${r.payload.spins_done}/${total}`, "good");
      }
      save();
    }

    function copyText(text){
      navigator.clipboard?.writeText(text).then(()=>{
        toast("Disalin ke clipboard.", "good");
      }).catch(()=>{
        toast("Gagal copy (browser).", "warn");
      });
    }

    function purgeExpired(){
      // In demo we keep history; only filter render states.
      // You can implement actual deletion if needed.
    }

    /* =========================
      BLOK 20 ‚Äî RENDER
    ========================== */
    function renderOdds(){
      const tb = $("oddsTbody");
      tb.innerHTML = "";
      const total = ODDS.reduce((s,x)=>s+x.pct,0);
      for(const o of ODDS){
        const tr = document.createElement("tr");
        const td1 = document.createElement("td");
        const td2 = document.createElement("td");
        td1.textContent = o.label;
        td2.className = "pct";
        td2.textContent = (o.pct % 1 === 0 ? o.pct.toFixed(0) : o.pct.toFixed(2)) + "%";
        tr.appendChild(td1); tr.appendChild(td2);
        tb.appendChild(tr);
      }
      const tr = document.createElement("tr");
      const td1 = document.createElement("td");
      const td2 = document.createElement("td");
      td1.innerHTML = "<b>Total</b>";
      td2.className = "pct";
      td2.innerHTML = "<b>" + (total % 1 === 0 ? total.toFixed(0) : total.toFixed(2)) + "%</b>";
      tr.appendChild(td1); tr.appendChild(td2);
      tb.appendChild(tr);
    }

    function renderMember(){
      // Boxes
      const myBoxes = $("myBoxes");
      myBoxes.innerHTML = "";
      const username = ($("m_username").value||$("a_username").value||"").trim();
      const boxes = state.boxes.filter(b => !username || b.username === username);

      if(boxes.length === 0){
        myBoxes.innerHTML = `<div class="note">Belum ada box. Ajukan claim dulu, lalu aktivasi pakai kode.</div>`;
      }else{
        for(const b of boxes){
          const st = b.status;
          const tag = st==="active" ? `<span class="tag good">ACTIVE</span>` :
                      st==="locked"? `<span class="tag warn">LOCKED</span>` :
                      `<span class="tag">OPENED</span>`;

          const el = document.createElement("div");
          el.className = "item";
          el.innerHTML = `
            <div class="left">
              <p class="title">Box ‚Ä¢ <span class="mono">${b.trx_ref}</span></p>
              <p class="meta">User: <b>${b.username}</b> ‚Ä¢ Nominal: <b>${fmtMoney(b.nominal)}</b><br>
              Dibuat: ${fmtTime(b.created_at)}${b.activated_at?` ‚Ä¢ Aktif: ${fmtTime(b.activated_at)}`:""}${b.opened_at?` ‚Ä¢ Dibuka: ${fmtTime(b.opened_at)}`:""}</p>
            </div>
            <div class="right">
              ${tag}
              ${st==="active" ? `<button class="btn primary" data-open="${b.id}"><span class="k">üéÅ</span> Buka Box</button>` : ``}
            </div>
          `;
          myBoxes.appendChild(el);
        }
        myBoxes.querySelectorAll("[data-open]").forEach(btn=>{
          btn.addEventListener("click", ()=> openBox(btn.getAttribute("data-open")));
        });
      }

      // Rewards
      const myRewards = $("myRewards");
      myRewards.innerHTML = "";
      const rewards = state.rewards.filter(r => !username || r.username === username);

      if(rewards.length === 0){
        myRewards.innerHTML = `<div class="note">Belum ada hadiah. Buka box untuk mendapatkan hadiah.</div>`;
      }else{
        for(const r of rewards){
          const expired = r.expires_at <= now();
          const left = msLeft(r.expires_at);
          const badge = expired ? `<span class="tag bad">EXPIRED</span>` : `<span class="tag good">AKTIF ${fmtLeftHours(left)}</span>`;

          let detail = "";
          let actions = "";

          if(r.type === "cashback"){
            detail = `Cashback: <b>${fmtMoney(r.payload.amount)}</b> (dari ${r.payload.percent}% ‚Ä¢ cap ${fmtMoney(r.payload.cap)})`;
            actions = `<span class="tag">Instant</span>`;
          }

          if(r.type === "voucher"){
            detail = `Voucher: <b>${fmtMoney(r.payload.amount)}</b>`;
            actions = expired ? `` : `<button class="btn ghost" data-copy="${r.payload.amount}"><span class="k">‚ßâ</span> Copy nominal</button>`;
          }

          if(r.type === "spin"){
            detail = `Spin manual: <b>${r.payload.spins}x</b> ‚Äî ${fmtMoney(r.payload.bet)}/spin ‚Ä¢ Provider: <b>${r.payload.provider || "Belum dipilih"}</b><br>
                      Progress (demo): <b>${r.payload.spins_done || 0}/${r.payload.spins}</b>`;
            const disabled = expired ? "disabled" : "";
            actions = `
              <button class="btn ghost" ${disabled} data-prov="${r.id}" data-p="PRAGMATIC PLAY"><span class="k">PP</span> Pragmatic</button>
              <button class="btn ghost" ${disabled} data-prov="${r.id}" data-p="PGSOFT"><span class="k">PG</span> PGSoft</button>
              <button class="btn primary" ${disabled} data-spin="${r.id}"><span class="k">‚ñ∂</span> Simulasi Spin</button>
            `;
          }

          const el = document.createElement("div");
          el.className = "item";
          el.innerHTML = `
            <div class="left">
              <p class="title">${rewardLabel(r)}</p>
              <p class="meta">User: <b>${r.username}</b> ‚Ä¢ TRX: <span class="mono">${r.trx_ref}</span><br>
              Didapat: ${fmtTime(r.created_at)} ‚Ä¢ ${detail}</p>
            </div>
            <div class="right">
              ${badge}
              ${actions}
            </div>
          `;
          myRewards.appendChild(el);
        }

        myRewards.querySelectorAll("[data-copy]").forEach(btn=>{
          btn.addEventListener("click", ()=> copyText(btn.getAttribute("data-copy")));
        });
        myRewards.querySelectorAll("[data-prov]").forEach(btn=>{
          btn.addEventListener("click", ()=> setProvider(btn.getAttribute("data-prov"), btn.getAttribute("data-p")));
        });
        myRewards.querySelectorAll("[data-spin]").forEach(btn=>{
          btn.addEventListener("click", ()=> simulateSpin(btn.getAttribute("data-spin")));
        });
      }
    }

    function renderCS(){
      // Pending claims
      const pending = state.claims.filter(c=>c.status==="pending");
      const csPending = $("csPending");
      csPending.innerHTML = "";
      if(pending.length === 0){
        csPending.innerHTML = `<div class="note">Tidak ada claim pending.</div>`;
      }else{
        for(const c of pending){
          const el = document.createElement("div");
          el.className = "item";
          el.innerHTML = `
            <div class="left">
              <p class="title">Claim Pending ‚Ä¢ <span class="mono">${c.trx_ref}</span></p>
              <p class="meta">User: <b>${c.username}</b> ‚Ä¢ Nominal: <b>${fmtMoney(c.nominal)}</b><br>
              Masuk: ${fmtTime(c.created_at)}${c.proof?`<br>Proof: <span class="mono">${escapeHtml(c.proof)}</span>`:""}</p>
            </div>
            <div class="right">
              <button class="btn good" data-approve="${c.id}"><span class="k">‚úì</span> Approve</button>
              <button class="btn danger" data-reject="${c.id}"><span class="k">‚úï</span> Reject</button>
            </div>
          `;
          csPending.appendChild(el);
        }
        csPending.querySelectorAll("[data-approve]").forEach(btn=>{
          btn.addEventListener("click", ()=> csApprove(btn.getAttribute("data-approve")));
        });
        csPending.querySelectorAll("[data-reject]").forEach(btn=>{
          btn.addEventListener("click", ()=> csReject(btn.getAttribute("data-reject")));
        });
      }

      // Active codes (unused)
      const csCodes = $("csCodes");
      csCodes.innerHTML = "";
      const activeCodes = state.codes.filter(cd => !cd.used_at);
      if(activeCodes.length === 0){
        csCodes.innerHTML = `<div class="note">Belum ada kode aktif.</div>`;
      }else{
        for(const cd of activeCodes){
          const expired = cd.expires_at <= now();
          const left = msLeft(cd.expires_at);
          const badge = expired ? `<span class="tag bad">EXPIRED</span>` : `<span class="tag good">Sisa ${fmtLeft(left)}</span>`;
          const el = document.createElement("div");
          el.className = "item";
          el.innerHTML = `
            <div class="left">
              <p class="title">Kode Voucher ‚Ä¢ <span class="mono">${cd.trx_ref}</span></p>
              <p class="meta">User: <b>${cd.username}</b> ‚Ä¢ Exp: ${fmtTime(cd.expires_at)} ‚Ä¢ Attempts: <b>${cd.attempts_left}x</b><br>
              <span class="mono"><b>${cd.code_preview || "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"}</b></span> <span class="faint">(demo-only tampilkan)</span></p>
            </div>
            <div class="right">
              ${badge}
              ${expired ? "" : `<button class="btn ghost" data-copycode="${cd.code_preview}"><span class="k">‚ßâ</span> Copy kode</button>`}
            </div>
          `;
          csCodes.appendChild(el);
        }
        csCodes.querySelectorAll("[data-copycode]").forEach(btn=>{
          btn.addEventListener("click", ()=> copyText(btn.getAttribute("data-copycode")));
        });
      }

      // Audit
      const csAudit = $("csAudit");
      csAudit.innerHTML = "";
      if(state.audit.length === 0){
        csAudit.innerHTML = `<div class="note">Belum ada aktivitas.</div>`;
      }else{
        for(const a of state.audit.slice(0, 18)){
          const el = document.createElement("div");
          el.className = "item";
          el.innerHTML = `
            <div class="left">
              <p class="title">${escapeHtml(a.text)}</p>
              <p class="meta">${fmtTime(a.ts)}</p>
            </div>
            <div class="right">
              <span class="tag">LOG</span>
            </div>
          `;
          csAudit.appendChild(el);
        }
      }
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function renderAll(){
      purgeExpired();
      renderOdds();
      renderMember();
      renderCS();
      // pill status quick hint
      const pending = state.claims.filter(c=>c.status==="pending").length;
      const activeCodes = state.codes.filter(cd=>!cd.used_at && cd.expires_at>now()).length;
      $("pillStatus").textContent = pending ? `${pending} claim pending` : (activeCodes ? `${activeCodes} kode aktif` : "Siap digunakan");
    }

    /* =========================
      BLOK 21 ‚Äî LIVE TICK (COUNTDOWNS)
    ========================== */
    setInterval(()=> {
      // re-render lightweight for countdown labels
      renderMember();
      renderCS();
      const pending = state.claims.filter(c=>c.status==="pending").length;
      const activeCodes = state.codes.filter(cd=>!cd.used_at && cd.expires_at>now()).length;
      $("pillStatus").textContent = pending ? `${pending} claim pending` : (activeCodes ? `${activeCodes} kode aktif` : "Siap digunakan");
    }, 1000);

    /* =========================
      BLOK 22 ‚Äî INIT
    ========================== */
    renderAll();

    // Small UX: if user types username in claim, mirror to activate
    $("m_username").addEventListener("input", ()=>{
      const v = $("m_username").value.trim();
      if(v && !$("a_username").value.trim()) $("a_username").value = v;
      renderMember();
    });
    $("a_username").addEventListener("input", renderMember);
    $("a_trx").addEventListener("input", renderMember);
  </script>
</body>
</html>
